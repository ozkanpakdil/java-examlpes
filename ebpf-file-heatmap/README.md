# eBPF File I/O Heatmap (Java)

This project provides a minimal eBPF-based file I/O monitoring tool with a Java frontend. It tracks `vfs_read` and `vfs_write` calls and displays the top 20 files by total bytes transferred.

## Prerequisites

- Linux Kernel with eBPF support (BTF enabled recommended)
- `clang`, `llvm`, `libbpf-dev`, `linux-headers-$(uname -r)`
- `maven`
- `java 25+`

## Project Structure

- `src/main/resources/ebpf/file_heatmap.bpf.c`: eBPF C code.
- `src/main/java/io/github/ozkanpakdil/LibBpf.java`: JNA interface for libbpf.
- `src/main/java/io/github/ozkanpakdil/Main.java`: Java application logic.
- `src/main/java/io/github/ozkanpakdil/HeatmapTUI.java`: Lanterna-based Terminal UI.
- `Makefile`: Build automation for C and Java.

## How to Build and Run

1.  **Install dependencies** (Ubuntu example):
    ```bash
    sudo apt update
    sudo apt install -y clang libbpf-dev linux-headers-$(uname -r) bpftool
    ```
    *Note: If `bpftool` is not in your PATH, you may need to update the `BPFTOOL` path in the `Makefile` (e.g., to `/usr/sbin/bpftool`).*

2.  **Build and Run**:
    ```bash
    make run
    ```
    *Note: Root privileges are required to load eBPF programs.*

3.  **Controls**:
    - **1-5**: Change sorting (Reads, Writes, R-Bytes, W-Bytes, Total).
    - **Q**: Quit.
    - **Ctrl+C**: Quit.

4.  **Generate Test I/O**:
    To see the heatmap in action, you can generate some disk I/O using the provided script:
    ```bash
    ./generate_io.sh
    ```
    This will create a temporary file, write data to it, read it back, and then delete it. You should see `test_io_file.tmp` appearing in the heatmap.

## Implementation Details

### eBPF Program
The eBPF program uses `kprobes` on `vfs_read` and `vfs_write`. It extracts the filename from the `struct file` using BPF CO-RE (Compile Once â€“ Run Everywhere) and updates a BPF Hash Map (`file_map`). To keep the project lightweight, we use a **minified** `vmlinux.h` generated by `bpftool`, which only contains the types necessary for our program.

### Java Frontend
The Java application uses JNA to call `libbpf` functions. It:
1.  Loads the eBPF bytecode.
2.  Attaches the kprobes.
3.  Periodically polls the BPF map.
4.  Displays a real-time heatmap in a Lanterna-based Terminal UI.
